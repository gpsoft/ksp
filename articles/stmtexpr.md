# 文と式

この記事には、ちょっと難しい話題が含まれています。難しすぎる場合は、後回しにしてもいいですよ。

## プログラムの二大構成要素

あなたが書くプログラムのコードは、一般に、文と式に分類できます。

- 文 ...statement、ステートメント
- 式 ...expression、エクスプレッション

文には、たとえば、代入文、`if`文、`for`文などがあります。一方、式の例は、四則演算式、比較式、関数呼び出し式、ラムダ式(lambda expression)などです。プログラムが動くとき、文は「実行され」、式は「評価され」ます。

どっちの方が重要ってことは無いのですが、この記事で注目したいのは、式の方です(端的に言えば、式は便利だ、という話しです)。

## 式

式は、評価され、評価結果に置き換わります。評価結果とは、四則演算式なら計算結果(数値)、比較式なら比較結果(真偽値)、関数呼び出し式なら関数の戻り値、ラムダ式なら関数オブジェクトそのものです。

そのため式は、値を書くべき場所になら、どこにでも書けます。

### 比較式の例

たとえば、配列の要素数が100を超えてるかどうかを変数に代入したいとしましょう。phpで書くと、こんな感じです。

```php
if ( count($items) > 100 ) {
    $tooMany = true;
} else {
    $tooMany = false;
}
```

しかし、これは、(1)代入文の右辺には値を書く、(2)比較式は評価されて真偽値に置き換わる、ということを知っていれば、以下のように書けます。

```php
$tooMany = count($items) > 100;
```

圧倒的にシンプルですね。

### ラムダ式と関数呼び出し式の例

JavaScriptには、IIFEというテクニックがあります。Immediately Invoked Function Expression、直訳すると「直ぐに呼び出される関数式」です。IIFEの使いどころは、

- 実行したいコードがある
- 少々複雑なので、他のコードと混ざらないように関数化したい
- でも、グローバルスコープは汚したくない

といったケースです(「グローバルスコープ」の意味が分からない場合は、ググるか想像力でカバーして下さい)。

```javascript
function someCode() {
    // 実行したい、少々複雑なコード
    ...
}

var hoge = someCode();
```

この書き方では、グローバルスコープに`someCode`という関数名が露出してしまいます。他のどこかで呼ばれてしまうかもしれないし、ひょっとすると、どこか別の場所で同名の関数が定義されているかもしれません。

そこで、IIFEの出番です。

```javascript
var hoge = (function() {
    // 実行したい、少々複雑なコード
    ...
})();
```

ここで起きているのも、やはり「式の評価」と「評価結果で置き換える」作業です。

- ラムダ式を評価して関数オブジェクトに置き換え
- 関数呼び出し式でその関数を呼び出して戻り値に置き換え

そして最後に、この戻り値が、`hoge`へ代入されます。

## 式の評価と置き換え

というわけで、プログラムを書く(読む)とき、それが式なのか文なのかを意識して下さい。もし式なら、そのコードは「この式を評価して、評価結果で置き換えろ」とコンピュータに命じているわけです。その式が何に評価されるのか、しっかり理解してコードを書き(読み)ましょう。

